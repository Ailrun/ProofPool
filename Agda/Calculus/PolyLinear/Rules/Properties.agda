module Calculus.PolyLinear.Rules.Properties where

open import Calculus.PolyLinear.Syntax
open import Calculus.PolyLinear.Syntax.Properties
open import Calculus.PolyLinear.Rules
open import Data.List
open import Data.List.Properties
open import Data.Product
open import Data.List.Relation.Binary.Pointwise hiding (refl)
open import Relation.Binary.PropositionalEquality

â‰¤ğ•Œ-trans : u  â‰¤ğ•Œ uâ€² â†’
           uâ€² â‰¤ğ•Œ uâ€³ â†’
           -----------
           u  â‰¤ğ•Œ uâ€³
â‰¤ğ•Œ-trans refl      â‰¤uâ€³  = â‰¤uâ€³
â‰¤ğ•Œ-trans 0/1â‚—â‰¤1/1â‚— refl = 0/1â‚—â‰¤1/1â‚—

â‰¤ğ•Œ-incğ•Œ : .{p : useableğ•Œ u} â†’ u â‰¤ğ•Œ incğ•Œ u p
â‰¤ğ•Œ-incğ•Œ {âˆâ‚—}   = refl
â‰¤ğ•Œ-incğ•Œ {0/1â‚—} = 0/1â‚—â‰¤1/1â‚—

â‰¤ğ•Œâ„‚ğ”¼-refl : E â‰¤ğ•Œâ„‚ğ”¼ E
â‰¤ğ•Œâ„‚ğ”¼-refl {K       /ğ•‚} = refl/ğ•‚
â‰¤ğ•Œâ„‚ğ”¼-refl {(T , u) /ğ•‹} = refl /ğ•‹

â‰¤ğ•Œâ„‚ğ”¼-trans : E  â‰¤ğ•Œâ„‚ğ”¼ Eâ€² â†’
             Eâ€² â‰¤ğ•Œâ„‚ğ”¼ Eâ€³ â†’
             -------------
             E  â‰¤ğ•Œâ„‚ğ”¼ Eâ€³
â‰¤ğ•Œâ„‚ğ”¼-trans refl/ğ•‚   â‰¤Eâ€³      = â‰¤Eâ€³
â‰¤ğ•Œâ„‚ğ”¼-trans (â‰¤uâ€² /ğ•‹) (â‰¤uâ€³ /ğ•‹) = â‰¤ğ•Œ-trans â‰¤uâ€² â‰¤uâ€³ /ğ•‹

/ğ•‹â‰¤ğ•Œâ„‚ğ”¼incğ•Œ/ğ•‹ : .{p : useableğ•Œ u} â†’ (T , u) /ğ•‹ â‰¤ğ•Œâ„‚ğ”¼ (T , incğ•Œ u p) /ğ•‹
/ğ•‹â‰¤ğ•Œâ„‚ğ”¼incğ•Œ/ğ•‹ = â‰¤ğ•Œ-incğ•Œ /ğ•‹

â‰¤ğ•Œâ„‚-refl : Î“ â‰¤ğ•Œâ„‚ Î“
â‰¤ğ•Œâ„‚-refl {[]}    = []
â‰¤ğ•Œâ„‚-refl {_ âˆ· _} = â‰¤ğ•Œâ„‚ğ”¼-refl âˆ· â‰¤ğ•Œâ„‚-refl

â‰¤ğ•Œâ„‚-trans : Î“ â‰¤ğ•Œâ„‚ Î“â€² â†’
            Î“â€² â‰¤ğ•Œâ„‚ Î“â€³ â†’
            ------------
            Î“ â‰¤ğ•Œâ„‚ Î“â€³
â‰¤ğ•Œâ„‚-trans []          []          = []
â‰¤ğ•Œâ„‚-trans (â‰¤Eâ€² âˆ· â‰¤Î“â€²) (â‰¤Eâ€³ âˆ· â‰¤Î“â€³) = â‰¤ğ•Œâ„‚ğ”¼-trans â‰¤Eâ€² â‰¤Eâ€³ âˆ· â‰¤ğ•Œâ„‚-trans â‰¤Î“â€² â‰¤Î“â€³

ğ•‚âˆˆ-det : x â¦‚ Kâ€² ğ•‚âˆˆ Î“ â†’
         x â¦‚ Kâ€³ ğ•‚âˆˆ Î“ â†’
         --------------
         Kâ€² â‰¡ Kâ€³
ğ•‚âˆˆ-det (here refl) (here refl) = refl
ğ•‚âˆˆ-det (there xâˆˆâ‚€) (there xâˆˆâ‚) = ğ•‚âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚

ğ•‹âˆˆ-det : x â¦‚ Tâ€² ğ•‹âˆˆ Î“ / Î“â€² â†’
         x â¦‚ Tâ€³ ğ•‹âˆˆ Î“ / Î“â€³ â†’
         -------------------
         Tâ€² â‰¡ Tâ€³ Ã— Î“â€² â‰¡ Î“â€³
ğ•‹âˆˆ-det (here refl) (here refl)      = refl , refl
ğ•‹âˆˆ-det (there xâˆˆâ‚€) (there xâˆˆâ‚)
  with refl , refl â† ğ•‹âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚ = refl , refl

ğ•‹âˆˆ-detâ‚ : x â¦‚ Tâ€² ğ•‹âˆˆ Î“ / Î“â€² â†’
          x â¦‚ Tâ€³ ğ•‹âˆˆ Î“ / Î“â€³ â†’
          -------------------
          Tâ€² â‰¡ Tâ€³
ğ•‹âˆˆ-detâ‚ xâˆˆâ‚€ xâˆˆâ‚ = projâ‚ (ğ•‹âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚)

ğ•‹âˆˆ-detâ‚‚ : x â¦‚ Tâ€² ğ•‹âˆˆ Î“ / Î“â€² â†’
          x â¦‚ Tâ€³ ğ•‹âˆˆ Î“ / Î“â€³ â†’
          -------------------
          Î“â€² â‰¡ Î“â€³
ğ•‹âˆˆ-detâ‚‚ xâˆˆâ‚€ xâˆˆâ‚ = projâ‚‚ (ğ•‹âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚)

Tâˆˆ-preserves-extractâ„‚â» : x â¦‚ Tâ€² ğ•‹âˆˆ Î“ / Î“â€² â†’
                         ---------------------------
                         extractâ„‚â» Î“ â‰¡ extractâ„‚â» Î“â€²
Tâˆˆ-preserves-extractâ„‚â» {Î“ = _ âˆ· _}    (here _)   = refl
Tâˆˆ-preserves-extractâ„‚â» {Î“ = _ /ğ•‚ âˆ· _} (there xâˆˆ) = cong (_ âˆ·_) (Tâˆˆ-preserves-extractâ„‚â» xâˆˆ)
Tâˆˆ-preserves-extractâ„‚â» {Î“ = _ /ğ•‹ âˆ· _} (there xâˆˆ) = cong (_ âˆ·_) (Tâˆˆ-preserves-extractâ„‚â» xâˆˆ)

Tâˆˆâ‡’â‰¤ğ•Œ : x â¦‚ Tâ€² ğ•‹âˆˆ Î“ / Î“â€² â†’
        ---------------------------
        Î“ â‰¤ğ•Œâ„‚ Î“â€²
Tâˆˆâ‡’â‰¤ğ•Œ (here _)   = /ğ•‹â‰¤ğ•Œâ„‚ğ”¼incğ•Œ/ğ•‹ âˆ· â‰¤ğ•Œâ„‚-refl
Tâˆˆâ‡’â‰¤ğ•Œ (there xâˆˆ) = â‰¤ğ•Œâ„‚ğ”¼-refl âˆ· Tâˆˆâ‡’â‰¤ğ•Œ xâˆˆ

ğ•‹âŠ¢-det : Î“ ğ•‹âŠ¢ T â¦‚ Kâ€² â†’
         Î“ ğ•‹âŠ¢ T â¦‚ Kâ€³ â†’
         --------------
         Kâ€² â‰¡ Kâ€³
ğ•‹âŠ¢-det (tvarâ‚— _ xâˆˆâ‚€) (tvarâ‚— _ xâˆˆâ‚) = ğ•‚âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚
ğ•‹âŠ¢-det (âŠ¢Tâ‚€ âŠ¸â‚— âŠ¢Uâ‚€)  (âŠ¢Tâ‚ âŠ¸â‚— âŠ¢Uâ‚)  = refl
ğ•‹âŠ¢-det (!â‚— âŠ¢Tâ‚€)      (!â‚— âŠ¢Tâ‚)      = refl
ğ•‹âŠ¢-det (âˆ€â‚—â‹†âˆ™ âŠ¢Tâ‚€)    (âˆ€â‚—â‹†âˆ™ âŠ¢Tâ‚)    = refl

ğ•„âŠ¢-det : Î“ ğ•„âŠ¢ M â¦‚ Tâ€² / Î“â€² â†’
         Î“ ğ•„âŠ¢ M â¦‚ Tâ€³ / Î“â€³ â†’
         -------------------
         Tâ€² â‰¡ Tâ€³ Ã— Î“â€² â‰¡ Î“â€³
ğ•„âŠ¢-det (varâ‚— xâˆˆâ‚€)              (varâ‚— xâˆˆâ‚)              = ğ•‹âˆˆ-det xâˆˆâ‚€ xâˆˆâ‚
ğ•„âŠ¢-det (Î»â‚— _ âˆ˜ âŠ¢Mâ‚€)            (Î»â‚— _ âˆ˜ âŠ¢Mâ‚)
  with Tâ€²â‰¡ , refl â† ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚
    with refl â† wkğ•‹-injective _ _ _ _ Tâ€²â‰¡              = refl , refl
ğ•„âŠ¢-det (âŠ¢Mâ‚€ $â‚—âˆ˜ âŠ¢Nâ‚€)           (âŠ¢Mâ‚ $â‚—âˆ˜ âŠ¢Nâ‚)
  with refl , refl â† ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚                    = refl , projâ‚‚ (ğ•„âŠ¢-det âŠ¢Nâ‚€ âŠ¢Nâ‚)
ğ•„âŠ¢-det (bangâ‚— âŠ¢Mâ‚€)             (bangâ‚— âŠ¢Mâ‚)             = cong !â‚—_ (projâ‚ (ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚)) , refl
ğ•„âŠ¢-det (let-bangâ‚— âŠ¢Mâ‚€ inâ‚— âŠ¢Nâ‚€) (let-bangâ‚— âŠ¢Mâ‚ inâ‚— âŠ¢Nâ‚)
  with refl , refl â† ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚
    with Tâ€²â‰¡ , refl â† ğ•„âŠ¢-det âŠ¢Nâ‚€ âŠ¢Nâ‚
      with refl â† wkğ•‹-injective _ _ _ _ Tâ€²â‰¡            = refl , refl
ğ•„âŠ¢-det (Î›â‚—â‹†âˆ™ âŠ¢Mâ‚€)              (Î›â‚—â‹†âˆ™ âŠ¢Mâ‚)
  with refl , refl â† ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚                    = refl , refl
ğ•„âŠ¢-det (âŠ¢Mâ‚€ $$â‚—âˆ™ âŠ¢Tâ‚€)          (âŠ¢Mâ‚ $$â‚—âˆ™ âŠ¢Tâ‚)
  with refl , refl â† ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚                    = refl , refl

ğ•„âŠ¢-detâ‚ : Î“ ğ•„âŠ¢ M â¦‚ Tâ€² / Î“â€² â†’
          Î“ ğ•„âŠ¢ M â¦‚ Tâ€³ / Î“â€³ â†’
          -------------------
          Tâ€² â‰¡ Tâ€³
ğ•„âŠ¢-detâ‚ âŠ¢Mâ‚€ âŠ¢Mâ‚ = projâ‚ (ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚)

ğ•„âŠ¢-detâ‚‚ : Î“ ğ•„âŠ¢ M â¦‚ Tâ€² / Î“â€² â†’
          Î“ ğ•„âŠ¢ M â¦‚ Tâ€³ / Î“â€³ â†’
          -------------------
          Î“â€² â‰¡ Î“â€³
ğ•„âŠ¢-detâ‚‚ âŠ¢Mâ‚€ âŠ¢Mâ‚ = projâ‚‚ (ğ•„âŠ¢-det âŠ¢Mâ‚€ âŠ¢Mâ‚)

ğ•„âŠ¢-preserves-extractâ„‚â» : Î“ ğ•„âŠ¢ M â¦‚ Tâ€² / Î“â€² â†’
                         ---------------------------
                         extractâ„‚â» Î“ â‰¡ extractâ„‚â» Î“â€²
ğ•„âŠ¢-preserves-extractâ„‚â» (varâ‚— xâˆˆ)             = Tâˆˆ-preserves-extractâ„‚â» xâˆˆ
ğ•„âŠ¢-preserves-extractâ„‚â» (Î»â‚— _ âˆ˜ âŠ¢M)           = âˆ·-injectiveÊ³ (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢M)
ğ•„âŠ¢-preserves-extractâ„‚â» (âŠ¢M $â‚—âˆ˜ âŠ¢N)           = trans (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢M) (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢N)
ğ•„âŠ¢-preserves-extractâ„‚â» (bangâ‚— âŠ¢M)            = refl
ğ•„âŠ¢-preserves-extractâ„‚â» (let-bangâ‚— âŠ¢M inâ‚— âŠ¢N) = trans (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢M) (âˆ·-injectiveÊ³ (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢N))
ğ•„âŠ¢-preserves-extractâ„‚â» (Î›â‚—â‹†âˆ™ âŠ¢M)             = âˆ·-injectiveÊ³ (ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢M)
ğ•„âŠ¢-preserves-extractâ„‚â» (âŠ¢M $$â‚—âˆ™ âŠ¢T)          = ğ•„âŠ¢-preserves-extractâ„‚â» âŠ¢M

ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ : Î“ ğ•„âŠ¢ M â¦‚ Tâ€² / Î“â€² â†’
        ---------------------------
        Î“ â‰¤ğ•Œâ„‚ Î“â€²
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (varâ‚— xâˆˆ)             = Tâˆˆâ‡’â‰¤ğ•Œ xâˆˆ
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (Î»â‚— _ âˆ˜ âŠ¢M)
  with _ âˆ· Î“â‰¤ â† ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M    = Î“â‰¤
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (âŠ¢M $â‚—âˆ˜ âŠ¢N)           = â‰¤ğ•Œâ„‚-trans (ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M) (ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢N)
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (bangâ‚— âŠ¢M)            = ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (let-bangâ‚— âŠ¢M inâ‚— âŠ¢N)
  with _ âˆ· Î“â€²â‰¤ â† ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢N   = â‰¤ğ•Œâ„‚-trans (ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M) Î“â€²â‰¤
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (Î›â‚—â‹†âˆ™ âŠ¢M)
  with _ âˆ· Î“â‰¤ â† ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M    = Î“â‰¤
ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ (âŠ¢M $$â‚—âˆ™ âŠ¢T)          = ğ•„âŠ¢â‡’â‰¤ğ•Œâ„‚ âŠ¢M
