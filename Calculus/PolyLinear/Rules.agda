module Calculus.PolyLinear.Rules where

open import Calculus.PolyLinear.Syntax
open import Data.List
open import Data.Nat
open import Data.Product
open import Relation.Binary.PropositionalEquality

infix 4 _â¦‚_ğ•‚âˆˆ_
infix 4 _â¦‚_ğ•‹âˆˆ_/_

data _â¦‚_ğ•‚âˆˆ_ : â„• â†’ ğ•‚ â†’ â„‚ â†’ Set where
  here  : K â‰¡ Kâ€² â†’
          -------------------
          0 â¦‚ K ğ•‚âˆˆ Kâ€² /ğ•‚ âˆ· Î“

  there : x â¦‚ K ğ•‚âˆˆ Î“ â†’
          -------------------
          suc x â¦‚ K ğ•‚âˆˆ E âˆ· Î“

data _â¦‚_ğ•‹âˆˆ_/_ : â„• â†’ ğ•‹ â†’ â„‚ â†’ â„‚ â†’ Set where
  here  : .{prf : useableğ•Œ u} â†’
          T â‰¡ Tâ€² â†’
          ----------------------------------------------------------------
          0 â¦‚ wkâˆ£ 1 â†‘ 0 âˆ£ T ğ•‹âˆˆ (Tâ€² , u) /ğ•‹ âˆ· Î“ / (Tâ€² , incğ•Œ u prf) /ğ•‹ âˆ· Î“

  there : x â¦‚ T ğ•‹âˆˆ Î“ / Î“â€² â†’
          ----------------------------------------
          suc x â¦‚ wkâˆ£ 1 â†‘ 0 âˆ£ T ğ•‹âˆˆ E âˆ· Î“ / E âˆ· Î“â€²

infix 4 â„‚âŠ¢_
infix 4 _â„‚ğ”¼âŠ¢_
infix 4 _ğ•‹âŠ¢_â¦‚_

data â„‚âŠ¢_ : â„‚ â†’ Set
data _â„‚ğ”¼âŠ¢_ : â„‚ â†’ â„‚ğ”¼ â†’ Set
data _ğ•‹âŠ¢_â¦‚_ : â„‚ â†’ ğ•‹ â†’ ğ•‚ â†’ Set

data â„‚âŠ¢_ where
  []  : ------
        â„‚âŠ¢ []

  _âˆ·_ : Î“ â„‚ğ”¼âŠ¢ E â†’
        â„‚âŠ¢ Î“ â†’
        ---------
        â„‚âŠ¢ E âˆ· Î“

data _â„‚ğ”¼âŠ¢_ where
  â‹†/ğ•‚ : Î“ â„‚ğ”¼âŠ¢ K /ğ•‚

  _/ğ•‹ : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
        -----------------
        Î“ â„‚ğ”¼âŠ¢ (T , u) /ğ•‹

data _ğ•‹âŠ¢_â¦‚_ where
  tvarâ‚— : â„‚âŠ¢ Î“ â†’
          x â¦‚ K ğ•‚âˆˆ Î“ â†’
          -----------------
          Î“ ğ•‹âŠ¢ tvarâ‚— x â¦‚ K

  _âŠ¸â‚—_  : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          Î“ ğ•‹âŠ¢ U â¦‚ Tyâ‚— â†’
          ------------------
          Î“ ğ•‹âŠ¢ T âŠ¸â‚— U â¦‚ Tyâ‚—

  !â‚—_   : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          ----------------
          Î“ ğ•‹âŠ¢ !â‚— T â¦‚ Tyâ‚—

  âˆ€â‚—â‹†âˆ™_ : K /ğ•‚ âˆ· Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          ----------------------
          Î“ ğ•‹âŠ¢ âˆ€â‚— K âˆ™ T â¦‚ Tyâ‚—

infix 4 _ğ•„âŠ¢_â¦‚_/_

data _ğ•„âŠ¢_â¦‚_/_ : â„‚ â†’ ğ•„ â†’ ğ•‹ â†’ â„‚ â†’ Set where
  varâ‚—           : x â¦‚ T ğ•‹âˆˆ Î“ / Î“â€² â†’
                   ---------------------
                   Î“ ğ•„âŠ¢ varâ‚— x â¦‚ T / Î“â€²

  Î»â‚—_âˆ˜_          : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
                   (T , 0/1â‚—) /ğ•‹ âˆ· Î“ ğ•„âŠ¢ M â¦‚ wkâˆ£ 1 â†‘ 0 âˆ£ U / (T , 1/1â‚—) /ğ•‹ âˆ· Î“â€² â†’
                   --------------------------------------------------------------
                   Î“ ğ•„âŠ¢ Î»â‚— T âˆ˜ M â¦‚ T âŠ¸â‚— U / Î“â€²

  _$â‚—âˆ˜_          : Î“ ğ•„âŠ¢ M â¦‚ T âŠ¸â‚— U / Î“â€² â†’
                   Î“â€² ğ•„âŠ¢ N â¦‚ T / Î“â€³ â†’
                   -----------------------
                   Î“ ğ•„âŠ¢ M $â‚—âˆ˜ N â¦‚ U / Î“â€³

  bangâ‚—          : Î“ ğ•„âŠ¢ M â¦‚ T / Î“ â†’
                   -------------------------
                   Î“ ğ•„âŠ¢ bangâ‚— M â¦‚ !â‚— T / Î“

  let-bangâ‚—_inâ‚—_ : Î“ ğ•„âŠ¢ M â¦‚ !â‚— T / Î“â€² â†’
                   (T , âˆâ‚—) /ğ•‹ âˆ· Î“â€² ğ•„âŠ¢ N â¦‚ wkâˆ£ 1 â†‘ 0 âˆ£ U / (T , âˆâ‚—) /ğ•‹ âˆ· Î“â€³ â†’
                   -------------------------------------------------------
                   Î“ ğ•„âŠ¢ let-bangâ‚— M inâ‚— N â¦‚ U / Î“â€³

  Î›â‚—â‹†âˆ™_          : K /ğ•‚ âˆ· Î“ ğ•„âŠ¢ M â¦‚ T / K /ğ•‚ âˆ· Î“â€² â†’
                   ------------------------------
                   Î“ ğ•„âŠ¢ Î›â‚— K âˆ™ M â¦‚ âˆ€â‚— K âˆ™ T / Î“â€²

  _$$â‚—âˆ™_         : Î“ ğ•„âŠ¢ M â¦‚ âˆ€â‚— K âˆ™ U / Î“â€² â†’
                   Î“â€² ğ•‹âŠ¢ T â¦‚ K â†’
                   ----------------------------------
                   Î“ ğ•„âŠ¢ M $$â‚—âˆ™ T â¦‚ sâˆ£ T /ğ•‹ / 0 âˆ£ U / Î“â€²

infix 4 _â‰¤ğ•Œ_
infix 4 _â‰¤ğ•Œâ„‚ğ”¼_
infix 4 _â‰¤ğ•Œâ„‚_

data _â‰¤ğ•Œ_ : ğ•Œ â†’ ğ•Œ â†’ Set where
  refl      : u â‰¤ğ•Œ u
  0/1â‚—â‰¤1/1â‚— : 0/1â‚— â‰¤ğ•Œ 1/1â‚—

data _â‰¤ğ•Œâ„‚ğ”¼_ : â„‚ğ”¼ â†’ â„‚ğ”¼ â†’ Set where
  refl/ğ•‚ : K /ğ•‚ â‰¤ğ•Œâ„‚ğ”¼ K /ğ•‚
  _/ğ•‹    : u â‰¤ğ•Œ uâ€² â†’
           ----------------------------
           (T , u) /ğ•‹ â‰¤ğ•Œâ„‚ğ”¼ (T , uâ€²) /ğ•‹

data _â‰¤ğ•Œâ„‚_ : â„‚ â†’ â„‚ â†’ Set where
  []  : [] â‰¤ğ•Œâ„‚ []
  _âˆ·_ : E â‰¤ğ•Œâ„‚ğ”¼ Eâ€² â†’
        Î“ â‰¤ğ•Œâ„‚ Î“â€² â†’
        ------------------
        E âˆ· Î“ â‰¤ğ•Œâ„‚ Eâ€² âˆ· Î“â€²
