module Calculus.PolyLinear.Rules where

open import Calculus.PolyLinear.Syntax
open import Data.List
open import Data.Nat
open import Data.Product
open import Relation.Binary.PropositionalEquality

infix 4 _â¦‚_ğ•‚âˆˆ_
infix 4 _â¦‚_ğ•‹âˆˆ_/_

data _â¦‚_ğ•‚âˆˆ_ : â„• â†’ ğ•‚ â†’ â„‚ â†’ Set where
  here   : K â‰¡ Kâ€² â†’
           ----------------
           0 â¦‚ K ğ•‚âˆˆ Kâ€² ğ•‚âˆ· Î“

  thereğ•‚ : x â¦‚ K ğ•‚âˆˆ Î“ â†’
           ---------------------
           suc x â¦‚ K ğ•‚âˆˆ Kâ€² ğ•‚âˆ· Î“

  thereğ•‹ : x â¦‚ K ğ•‚âˆˆ Î“ â†’
           --------------------------
           x â¦‚ K ğ•‚âˆˆ (T , u) ğ•‹âˆ· Î“

data _â¦‚_ğ•‹âˆˆ_/_ : â„• â†’ ğ•‹ â†’ â„‚ â†’ â„‚ â†’ Set where
  here   : .{prf : useableğ•Œ u} â†’
           T â‰¡ Tâ€² â†’
           --------------------------------------------
           0 â¦‚ T ğ•‹âˆˆ (Tâ€² , u) ğ•‹âˆ· Î“ / (Tâ€² , incğ•Œ u prf) ğ•‹âˆ· Î“

  thereğ•‹ : x â¦‚ T ğ•‹âˆˆ Î“ / Î“â€² â†’
           --------------------------------------------
           suc x â¦‚ T ğ•‹âˆˆ (Tâ€² , u) ğ•‹âˆ· Î“ / (Tâ€² , u) ğ•‹âˆ· Î“â€²

  thereğ•‚ : x â¦‚ T ğ•‹âˆˆ Î“ / Î“â€² â†’
           -------------------------
           x â¦‚ T ğ•‹âˆˆ K ğ•‚âˆ· Î“ / K ğ•‚âˆ· Î“â€²

infix 4 â„‚âŠ¢_
infix 4 _ğ•‹âŠ¢_â¦‚_

data â„‚âŠ¢_ : â„‚ â†’ Set
data _ğ•‹âŠ¢_â¦‚_ : â„‚ â†’ ğ•‹ â†’ ğ•‚ â†’ Set

data â„‚âŠ¢_ where
  []   : ------
         â„‚âŠ¢ []

  â‹†ğ•‚âˆ·_ : â„‚âŠ¢ Î“ â†’
         ----------
         â„‚âŠ¢ K ğ•‚âˆ· Î“

  _ğ•‹âˆ·_ : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
         â„‚âŠ¢ Î“ â†’
         ----------------
         â„‚âŠ¢ (T , u) ğ•‹âˆ· Î“

data _ğ•‹âŠ¢_â¦‚_ where
  tvarâ‚— : x â¦‚ K ğ•‚âˆˆ Î“ â†’
          -----------------
          Î“ ğ•‹âŠ¢ tvarâ‚— x â¦‚ K

  _âŠ¸â‚—_  : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          Î“ ğ•‹âŠ¢ U â¦‚ Tyâ‚— â†’
          ------------------
          Î“ ğ•‹âŠ¢ T âŠ¸â‚— U â¦‚ Tyâ‚—

  !â‚—_   : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          ----------------
          Î“ ğ•‹âŠ¢ !â‚— T â¦‚ Tyâ‚—

  âˆ€â‚—â‹†âˆ™_ : K ğ•‚âˆ· Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
          --------------------
          Î“ ğ•‹âŠ¢ âˆ€â‚— K âˆ™ T â¦‚ Tyâ‚—

infix 4 _ğ•„âŠ¢_â¦‚_/_

data _ğ•„âŠ¢_â¦‚_/_ : â„‚ â†’ ğ•„ â†’ ğ•‹ â†’ â„‚ â†’ Set where
  varâ‚—           : x â¦‚ T ğ•‹âˆˆ Î“ / Î“â€² â†’
                   ---------------------
                   Î“ ğ•„âŠ¢ varâ‚— x â¦‚ T / Î“â€²

  Î»â‚—_âˆ˜_          : Î“ ğ•‹âŠ¢ T â¦‚ Tyâ‚— â†’
                   (T , 0/1â‚—) ğ•‹âˆ· Î“ ğ•„âŠ¢ M â¦‚ U / (T , 1/1â‚—) ğ•‹âˆ· Î“â€² â†’
                   ----------------------------------------------
                   Î“ ğ•„âŠ¢ Î»â‚— T âˆ˜ M â¦‚ T âŠ¸â‚— U / Î“â€²

  _$â‚—âˆ˜_          : Î“ ğ•„âŠ¢ M â¦‚ T âŠ¸â‚— U / Î“â€² â†’
                   Î“â€² ğ•„âŠ¢ N â¦‚ T / Î“â€³ â†’
                   -----------------------
                   Î“ ğ•„âŠ¢ M $â‚—âˆ˜ N â¦‚ U / Î“â€³

  bangâ‚—          : Î“ ğ•„âŠ¢ M â¦‚ T / Î“ â†’
                   -------------------------
                   Î“ ğ•„âŠ¢ bangâ‚— M â¦‚ !â‚— T / Î“

  let-bangâ‚—_inâ‚—_ : Î“ ğ•„âŠ¢ M â¦‚ !â‚— T / Î“â€² â†’
                   (T , âˆâ‚—) ğ•‹âˆ· Î“â€² ğ•„âŠ¢ N â¦‚ U / (T , âˆâ‚—) ğ•‹âˆ· Î“â€³ â†’
                   -------------------------------------------
                   Î“ ğ•„âŠ¢ let-bangâ‚— M inâ‚— N â¦‚ U / Î“â€³

  Î›â‚—â‹†âˆ™_          : K ğ•‚âˆ· Î“ ğ•„âŠ¢ M â¦‚ T / K ğ•‚âˆ· Î“â€² â†’
                   ------------------------------
                   Î“ ğ•„âŠ¢ Î›â‚— K âˆ™ M â¦‚ âˆ€â‚— K âˆ™ T / Î“â€²

  _$$â‚—âˆ™_         : Î“ ğ•„âŠ¢ M â¦‚ âˆ€â‚— K âˆ™ U / Î“â€² â†’
                   Î“â€² ğ•‹âŠ¢ T â¦‚ K â†’
                   -------------------------
                   Î“ ğ•„âŠ¢ M $$â‚—âˆ™ T â¦‚ U / Î“â€²

infix 4 _â‰¤ğ•Œ_
infix 4 _â‰¤ğ•Œâ„‚_

data _â‰¤ğ•Œ_ : ğ•Œ â†’ ğ•Œ â†’ Set where
  refl      : u â‰¤ğ•Œ u
  0/1â‚—â‰¤1/1â‚— : 0/1â‚— â‰¤ğ•Œ 1/1â‚—

data _â‰¤ğ•Œâ„‚_ : â„‚ â†’ â„‚ â†’ Set where
  []        : [] â‰¤ğ•Œâ„‚ []
  â‹†ğ•‚âˆ·_      : Î“ â‰¤ğ•Œâ„‚ Î“â€² â†’
              -------------------
              K ğ•‚âˆ· Î“ â‰¤ğ•Œâ„‚ K ğ•‚âˆ· Î“â€²

  _ğ•‹âˆ·_      : u â‰¤ğ•Œ uâ€² â†’
              Î“ â‰¤ğ•Œâ„‚ Î“â€² â†’
              --------------------------------
              (T , u) ğ•‹âˆ· Î“ â‰¤ğ•Œâ„‚ (T , uâ€²) ğ•‹âˆ· Î“â€²
