module Calculus.PolyLinear.Rules.Weakening where

open import Calculus.PolyLinear.Syntax
open import Calculus.PolyLinear.Syntax.Properties
open import Calculus.PolyLinear.Rules
open import Data.List
open import Data.Nat
open import Data.Nat.Properties
open import Data.Product
open import Relation.Binary.PropositionalEquality
open import Relation.Nullary
open import Relation.Nullary.Decidable

ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ : x â¦‚ K ğ•‚âˆˆ Î“â€² â†’ len Î” + x â¦‚ wkâˆ£ len Î” â†‘ 0 âˆ£ K ğ•‚âˆˆ Î” ++ Î“â€²
ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ {K = K} {Î” = []}    xâˆˆ
  rewrite wkğ•‚âˆ£0â†‘xâˆ£â‰¡id K 0          = xâˆˆ
ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ {K = K} {Î” = _ âˆ· _} xâˆˆ = there (ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ xâˆˆ)

ğ•‹âˆˆâ‡’len+ğ•‹âˆˆ++ : x â¦‚ T ğ•‹âˆˆ Î“â€² / Î“â€³ â†’ len Î” + x â¦‚ wkâˆ£ len Î” â†‘ 0 âˆ£ T ğ•‹âˆˆ Î” ++ Î“â€² / Î” ++ Î“â€³
ğ•‹âˆˆâ‡’len+ğ•‹âˆˆ++ {T = T} {Î” = []}    xâˆˆ
  rewrite wkğ•‹âˆ£0â†‘xâˆ£â‰¡id T 0          = xâˆˆ
ğ•‹âˆˆâ‡’len+ğ•‹âˆˆ++ {T = T} {Î” = _ âˆ· _} xâˆˆ = {!!} -- requires weakening decomposition

â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ : âˆ€ Î“ â†’ x â‰¥ len Î“ â†’ x â¦‚ K ğ•‚âˆˆ Î“ ++ Î“â€² â†’ len Î” + x â¦‚ wkâˆ£ len Î” â†‘ 0 âˆ£ K ğ•‚âˆˆ wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€²
â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++                     []      zâ‰¤n      xâˆˆ         = ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ xâˆˆ
â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ {x = suc x} {Î” = Î”} (_ âˆ· Î“) (sâ‰¤s xâ‰¥) (there xâˆˆ)
  rewrite +-suc (len Î”) x                                             = there (â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ Î“ xâ‰¥ xâˆˆ)

<lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ : âˆ€ Î“ â†’ x < len Î“ â†’ x â¦‚ K ğ•‚âˆˆ Î“ ++ Î“â€² â†’ x â¦‚ wkâˆ£ len Î” â†‘ len Î“ âˆ£ K ğ•‚âˆˆ wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€²
<lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) x<       (here refl) = here refl
<lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) (sâ‰¤s x<) (there xâˆˆ)  = there (<lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ Î“ x< xâˆˆ)

wkâˆ£â†‘âˆ£ğ•‚âˆˆ : âˆ€ Î“ â†’
          x â¦‚ K ğ•‚âˆˆ Î“ ++ Î“â€² â†’
          --------------------------------------------
          wkâˆ£ len Î” â†‘ len Î“ âˆ£ x â¦‚ wkâˆ£ len Î” â†‘ len Î“ âˆ£ K ğ•‚âˆˆ wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€²
wkâˆ£â†‘âˆ£ğ•‚âˆˆ {x} []               xâˆˆ
  rewrite projâ‚‚ (dec-yes (x â‰¥? 0) zâ‰¤n) = ğ•‚âˆˆâ‡’len+ğ•‚âˆˆ++ xâˆˆ
wkâˆ£â†‘âˆ£ğ•‚âˆˆ {x} (K       /ğ•‚ âˆ· Î“) xâˆˆ
  with x â‰¥? suc (len Î“)
...  | yes xâ‰¥                          = â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) xâ‰¥ xâˆˆ
...  | no  xâ‰±                          = <lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) (â‰°â‡’> xâ‰±) xâˆˆ
wkâˆ£â†‘âˆ£ğ•‚âˆˆ {x} ((T , u) /ğ•‹ âˆ· Î“) xâˆˆ
  with x â‰¥? suc (len Î“)
...  | yes xâ‰¥                          = â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) xâ‰¥ xâˆˆ
...  | no  xâ‰±                          = <lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) (â‰°â‡’> xâ‰±) xâˆˆ

wkâˆ£â†‘âˆ£ğ•‹âˆˆ : âˆ€ Î“ â†’
          x â¦‚ T ğ•‹âˆˆ Î“ ++ Î“â€² / Î“â‚€ â†’
          --------------------------------------------
          let Î“â€³ , Î“â€´ = splitAt (len Î“) Î“â‚€ in
          wkâˆ£ len Î” â†‘ len Î“ âˆ£ x â¦‚ wkâˆ£ len Î” â†‘ len Î“ âˆ£ T ğ•‹âˆˆ wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€² / wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“â€³ ++ Î” ++ Î“â€´
wkâˆ£â†‘âˆ£ğ•‹âˆˆ {x} []               xâˆˆ
  rewrite projâ‚‚ (dec-yes (x â‰¥? 0) zâ‰¤n) = ğ•‹âˆˆâ‡’len+ğ•‹âˆˆ++ xâˆˆ
wkâˆ£â†‘âˆ£ğ•‹âˆˆ {x} (K       /ğ•‚ âˆ· Î“) xâˆˆ
  with x â‰¥? suc (len Î“)
...  | yes xâ‰¥                          = {!!} -- â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) xâ‰¥ xâˆˆ
...  | no  xâ‰±                          = {!!} -- <lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) (â‰°â‡’> xâ‰±) xâˆˆ
wkâˆ£â†‘âˆ£ğ•‹âˆˆ {x} ((T , u) /ğ•‹ âˆ· Î“) xâˆˆ
  with x â‰¥? suc (len Î“)
...  | yes xâ‰¥                          = {!!} -- â‰¥lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) xâ‰¥ xâˆˆ
...  | no  xâ‰±                          = {!!} -- <lenâ‡’ğ•‚âˆˆ++â‡’len+ğ•‚âˆˆ++-++ (_ âˆ· Î“) (â‰°â‡’> xâ‰±) xâˆˆ

ğ•‹âŠ¢wkâˆ£â†‘âˆ£ : âˆ€ Î“ â†’
          â„‚âŠ¢ Î” ++ Î“â€² â†’
          Î“ ++ Î“â€² ğ•‹âŠ¢ T â¦‚ K â†’
          --------------------------------------------
          wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€² ğ•‹âŠ¢ wkâˆ£ len Î” â†‘ len Î“ âˆ£ T â¦‚ wkâˆ£ len Î” â†‘ len Î“ âˆ£ K
â„‚âŠ¢wkâˆ£â†‘âˆ£ : âˆ€ Î“ â†’
          â„‚âŠ¢ Î” ++ Î“â€² â†’
          â„‚âŠ¢ Î“ ++ Î“â€² â†’
          ---------------
          â„‚âŠ¢ wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€²

ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (tvarâ‚— âŠ¢Î“Î“â€² xâˆˆ) = tvarâ‚— (â„‚âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢Î“Î“â€²) (wkâˆ£â†‘âˆ£ğ•‚âˆˆ Î“ xâˆˆ)
ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (âŠ¢T âŠ¸â‚— âŠ¢U)      = ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢T âŠ¸â‚— ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢U
ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (!â‚— âŠ¢T)         = !â‚— (ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢T)
ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (âˆ€â‚—â‹†âˆ™ âŠ¢T)       = âˆ€â‚—â‹†âˆ™ (ğ•‹âŠ¢wkâˆ£â†‘âˆ£ (_ âˆ· Î“) âŠ¢Î”Î“â€² âŠ¢T)

â„‚âŠ¢wkâˆ£â†‘âˆ£ []               âŠ¢Î”Î“â€² âŠ¢Î“Î“â€²           = âŠ¢Î”Î“â€²
â„‚âŠ¢wkâˆ£â†‘âˆ£ (K       /ğ•‚ âˆ· Î“) âŠ¢Î”Î“â€² (â‹†/ğ•‚   âˆ· âŠ¢Î“Î“â€²) = â‹†/ğ•‚ âˆ· â„‚âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢Î“Î“â€²
â„‚âŠ¢wkâˆ£â†‘âˆ£ ((T , u) /ğ•‹ âˆ· Î“) âŠ¢Î”Î“â€² (âŠ¢T /ğ•‹ âˆ· âŠ¢Î“Î“â€²) = ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢T /ğ•‹ âˆ· â„‚âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢Î“Î“â€²

ğ•„âŠ¢wkâˆ£â†‘âˆ£ : âˆ€ Î“ â†’
          â„‚âŠ¢ Î” ++ Î“â€² â†’
          Î“ ++ Î“â€² ğ•„âŠ¢ M â¦‚ T / Î“â‚€ â†’
          --------------------------------------------
          let Î“â€³ , Î“â€´ = splitAt (len Î“) Î“â‚€ in
          wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“ ++ Î” ++ Î“â€² ğ•„âŠ¢ wkâˆ£ len Î” â†‘ len Î“ âˆ£ M â¦‚ wkâˆ£ len Î” â†‘ len Î“ âˆ£ T / wkâˆ£ len Î” â†‘ len Î“ âˆ£ Î“â€³ ++ Î” ++ Î“â€´
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (varâ‚— x) = varâ‚— {!!}
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (Î»â‚— âŠ¢T âˆ˜ âŠ¢M) = Î»â‚— ğ•‹âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢T âˆ˜ {!ğ•„âŠ¢wkâˆ£â†‘âˆ£ (_ âˆ· Î“) âŠ¢Î”Î“â€² âŠ¢M!} -- requires weakening exchange
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (âŠ¢M $â‚—âˆ˜ âŠ¢N) = ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢M $â‚—âˆ˜ {!ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢N!}
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (bangâ‚— âŠ¢M) = {!!}
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (let-bangâ‚— âŠ¢M inâ‚— âŠ¢N) = let-bangâ‚— ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² âŠ¢M inâ‚— {!!}
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (Î›â‚—â‹†âˆ™ âŠ¢M) = Î›â‚—â‹†âˆ™ ğ•„âŠ¢wkâˆ£â†‘âˆ£ (_ âˆ· Î“) âŠ¢Î”Î“â€² âŠ¢M
ğ•„âŠ¢wkâˆ£â†‘âˆ£ Î“ âŠ¢Î”Î“â€² (âŠ¢M $$â‚—âˆ™ âŠ¢T) = {!!} -- requires weakening over substitution
